# 運用メモ（Agents 向け）

本プロジェクトは以下の卒業研究テーマを実施するための環境・スクリプトを扱います。

**テーマ**:「小型移動ロボットにおける VLM ダイレクト制御とハイブリッド制御の比較評価」  
**サブタイトル案**:「OSOYOO ラズパイロボットカーと smolVLM を用いたターゲット到達タスクでの実験的検討」

## 想定する研究タスクと要件

- カメラ付き OSOYOO ロボットカーを LAN 内の Mac/PC から制御し、軽量 VLM（smolVLM2-mlx）でターゲット認識／行動決定を行う。
- 比較対象は以下 2 系統（任意でクラシカル画像処理も追加可）。
  - **条件A: VLM ダイレクト制御** … VLM が `LEFT/RIGHT/FORWARD/STOP` など次の行動を直接決める。
  - **条件B: VLM 認識＋ルール制御** … VLM には「ターゲット位置（LEFT/CENTER/RIGHT）」「距離（FAR/MID/NEAR）」のみ答えさせ、行動はルールで決定。
- タスクは「複数物体の中から指定物体（例: 黒い UCC ボトル）の前まで自律移動し停止する」。
- 評価指標: 成功率、平均到達時間、コマンド切り替えの安定性（反転回数等）。
- 曖昧指示・照明変化などを加えてロバスト性を追加評価しても良い。
- これらを通じて「VLM をどのレイヤーまで信頼できるか」「軽量構成での実用限界」を示す。

## 運用ルール

1. **言語**  
   - すべてのログ・コミットメッセージ・README 追記は原則日本語で記述する。
2. **アーキテクチャ**  
   - Lesson 6 (`camera.sh`, `startcam.py`, `picar4.sh`, `webcar.py`) を出発点としつつ、研究タスクでは `raspi_agent.py` を追加常駐させる。  
   - PC 側は `pc_controller_direct.py`（条件A）と `pc_controller_hybrid.py`（条件B）を利用し、同じターゲット到達タスクで比較する。  
   - 旧 ESP32-CAM / WebSocket 互換コードは使用禁止。
3. **通信設定**  
   - 映像: `http://<PiのIP>:8899/stream.mjpg`（教材）、または `http://<PiのIP>:8080/frame.jpg` / `/stream.mjpg`（raspi_agent）。
   - 制御: `http://<PiのIP>:5000/?action=command&...`（教材 Flask）または `http://<PiのIP>:8080/command`（raspi_agent）。
   - 研究計測中は `AGENT_URL` を環境変数に設定し、Makefile ターゲット (`pc-direct` / `pc-hybrid`) を用いる。
   - 現在 (2025-11-11) の Pi IP: `192.168.0.12`。変更した場合は README と本ファイルの両方を更新すること。
4. **安全運用・ログ**  
   - 開発時は DEBUG ログで VLM 応答・送信コマンドを必ず記録し、実験シートに転記。  
   - WATCHDOG（raspi_agent の 2 秒タイムアウト）で停止する構成を維持し、実空間では常に STOP コマンド即時送出の準備をする。

更新時は上記テーマや運用ルールの変更・補足理由と日付を追記してください。

---

## 更新履歴

- 2025-11-11: 卒研テーマ概要・A/B 比較要件を追記。Pi IP を 192.168.0.12 に更新。
- 2025-11-10: Raspberry Pi の固定 IP を 192.168.11.4 に変更したため、カメラ／制御 URL の記載を更新。
